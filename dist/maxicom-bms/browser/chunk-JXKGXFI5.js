import"./chunk-MS4AQ6UA.js";import{a as Ct,b as ht,c as w,d as vt}from"./chunk-PET2T5QB.js";import{a as bt}from"./chunk-CN27XA4P.js";import{a as Pt,b as yt,c as Dt,d as wt,e as Et,f as It,g as Ft,h as Bt,i as Ot}from"./chunk-S6RU42MV.js";import{a as ot,b as nt,c as rt,d as lt,e as mt,f as dt,g as pt,h as st,i as ct,j as ft,k as ut,l as _t,m as gt}from"./chunk-M64ZZ4XY.js";import{a as Mt,b as xt}from"./chunk-PBPL5AEM.js";import{i as St}from"./chunk-G6CURNGL.js";import"./chunk-QAKHC542.js";import{a as W,f as X,g as et,h as it,i as at}from"./chunk-ALYBDDWS.js";import{Ia as j,Na as h,Pa as L,Qa as G,Ta as H,Wa as Y,Xa as Q,Ya as U,Za as J,_a as K,ab as Z,gb as tt,h as $,i as b,ka as V,la as q,m as P,qa as z,sa as y,ta as D}from"./chunk-7DJ2AMDO.js";import{$b as N,Bb as m,Kb as a,Lb as o,Mb as u,Nb as _,Ob as g,Qb as O,Ub as C,Vb as s,Zb as T,_b as R,bb as r,dc as n,ec as f,fc as v,gb as c,gc as A,ma as I,na as F,nb as x,nc as k,tb as p}from"./chunk-4XLDPXVN.js";import{c as B}from"./chunk-C6Q5SG76.js";function qt(t,i){if(t&1&&(a(0,"mat-option",14),n(1),o()),t&2){let e=i.$implicit;m("value",e.id),r(),A(" ",e.alias," (",e.devicePath,") ")}}function zt(t,i){if(t&1&&(a(0,"mat-form-field",4)(1,"mat-label"),n(2,"Select Port"),o(),a(3,"mat-select",13),p(4,qt,2,3,"mat-option",6),o()()),t&2){let e=s();r(4),m("ngForOf",e.availablePortsForSelection)}}function jt(t,i){if(t&1&&(a(0,"mat-form-field",15)(1,"mat-label"),n(2,"Port"),o(),u(3,"input",16),o()),t&2){let e=s();r(3),m("value",(e.data.port==null?null:e.data.port.alias)+" ("+(e.data.port==null?null:e.data.port.port)+")")}}function Lt(t,i){if(t&1&&(a(0,"mat-option",14),n(1),o()),t&2){let e=i.$implicit;m("value",e),r(),v(" ",e," ")}}function Gt(t,i){if(t&1&&(a(0,"mat-option",14),n(1),o()),t&2){let e=i.$implicit;m("value",e),r(),v(" ",e," ")}}function Ht(t,i){if(t&1&&(a(0,"mat-option",14),n(1),o()),t&2){let e=i.$implicit;m("value",e.value),r(),v(" ",e.viewValue," ")}}function Yt(t,i){if(t&1&&(a(0,"mat-option",14),n(1),o()),t&2){let e=i.$implicit;m("value",e),r(),v(" ",e," ")}}var E=class t{constructor(i,e,l){this.fb=i;this.dialogRef=e;this.data=l;this.isEditMode=!!this.data.port,!this.isEditMode&&this.data.availablePorts&&this.data.configuredPortIds&&(this.availablePortsForSelection=this.data.availablePorts.filter(d=>!this.data.configuredPortIds.includes(d.id))),this.parityDisplayOptions=this.data.parityOptions.map(d=>({value:d,viewValue:d.replace("PARITY_","")})),this.portForm=this.fb.group({portId:[this.data.port?.id||(this.availablePortsForSelection.length>0?this.availablePortsForSelection[0].id:""),this.isEditMode?[]:h.required],baudRate:[this.data.port?.baudRate||9600,h.required],dataBits:[this.data.port?.dataBits||8,h.required],stopBits:[this.data.port?.stopBits||1,h.required],parity:[this.data.port?.parity||"PARITY_NONE",h.required]})}portForm;isEditMode;availablePortsForSelection=[];parityDisplayOptions=[];onCancel(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||t)(c(J),c(Pt),c(yt))};static \u0275cmp=x({type:t,selectors:[["app-serial-form"]],decls:31,vars:10,consts:[["mat-dialog-title",""],[1,"serial-form",3,"formGroup"],["appearance","outline","class","form-field",4,"ngIf"],["appearance","outline","class","form-field","disabled","",4,"ngIf"],["appearance","outline",1,"form-field"],["formControlName","baudRate","required",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","dataBits","required",""],["formControlName","parity","required",""],["formControlName","stopBits","required",""],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"mat-dialog-close","disabled"],["formControlName","portId","required",""],[3,"value"],["appearance","outline","disabled","",1,"form-field"],["matInput","","readonly","",3,"value"]],template:function(e,l){e&1&&(a(0,"h2",0),n(1),o(),a(2,"mat-dialog-content")(3,"form",1),p(4,zt,5,1,"mat-form-field",2)(5,jt,4,1,"mat-form-field",3),a(6,"mat-form-field",4)(7,"mat-label"),n(8,"Baud Rate"),o(),a(9,"mat-select",5),p(10,Lt,2,2,"mat-option",6),o()(),a(11,"mat-form-field",4)(12,"mat-label"),n(13,"Data Bits"),o(),a(14,"mat-select",7),p(15,Gt,2,2,"mat-option",6),o()(),a(16,"mat-form-field",4)(17,"mat-label"),n(18,"Parity"),o(),a(19,"mat-select",8),p(20,Ht,2,2,"mat-option",6),o()(),a(21,"mat-form-field",4)(22,"mat-label"),n(23,"Stop Bits"),o(),a(24,"mat-select",9),p(25,Yt,2,2,"mat-option",6),o()()()(),a(26,"mat-dialog-actions",10)(27,"button",11),C("click",function(){return l.onCancel()}),n(28,"Cancel"),o(),a(29,"button",12),n(30," Save "),o()()),e&2&&(r(),f(l.data.port?"Edit Port":"Add Port"),r(2),m("formGroup",l.portForm),r(),m("ngIf",!l.isEditMode&&l.availablePortsForSelection.length>0),r(),m("ngIf",l.isEditMode),r(5),m("ngForOf",l.data.baudRates),r(5),m("ngForOf",l.data.dataBits),r(5),m("ngForOf",l.parityDisplayOptions),r(5),m("ngForOf",l.data.stopBits),r(4),m("mat-dialog-close",l.portForm.value)("disabled",l.portForm.invalid))},dependencies:[P,$,b,K,H,L,G,U,Y,Q,Bt,wt,Et,Ft,It,et,tt,Z,ht,Ct,St,at,it,D,y],styles:[".serial-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding-top:16px}.form-field[_ngcontent-%COMP%]{width:100%}@media (max-width: 500px){.serial-form[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};var Qt=()=>[3];function Ut(t,i){t&1&&(a(0,"div",10),u(1,"mat-spinner"),a(2,"p"),n(3,"Loading Serial port configuration..."),o()())}function Jt(t,i){t&1&&(a(0,"th",26),n(1,"Name"),o())}function Kt(t,i){if(t&1&&(a(0,"td",27),n(1),o()),t&2){let e=i.$implicit;r(),f(e.alias)}}function Wt(t,i){t&1&&(a(0,"th",26),n(1,"Baud Rate"),o())}function Xt(t,i){if(t&1&&(a(0,"td",27),n(1),o()),t&2){let e=i.$implicit;r(),f(e.baudRate)}}function Zt(t,i){t&1&&(a(0,"th",26),n(1,"Data Bits"),o())}function te(t,i){if(t&1&&(a(0,"td",27),n(1),o()),t&2){let e=i.$implicit;r(),f(e.dataBits)}}function ee(t,i){t&1&&(a(0,"th",26),n(1,"Parity"),o())}function ie(t,i){if(t&1&&(a(0,"td",27),n(1),o()),t&2){let e=i.$implicit,l=s(2);r(),f(l.formatParity(e.parity))}}function ae(t,i){t&1&&(a(0,"th",26),n(1,"Stop Bits"),o())}function oe(t,i){if(t&1&&(a(0,"td",27),n(1),o()),t&2){let e=i.$implicit;r(),f(e.stopBits)}}function ne(t,i){t&1&&(a(0,"th",26),n(1,"Actions"),o())}function re(t,i){if(t&1){let e=O();a(0,"td",27)(1,"button",28),C("click",function(){let d=I(e).$implicit,S=s(2);return F(S.openPortForm(d))}),a(2,"mat-icon"),n(3,"edit"),o()(),a(4,"button",29),C("click",function(){let d=I(e).$implicit,S=s(2);return F(S.deletePort(d))}),a(5,"mat-icon"),n(6,"delete"),o()()()}}function le(t,i){t&1&&u(0,"tr",30)}function me(t,i){t&1&&u(0,"tr",31)}function de(t,i){if(t&1&&(a(0,"tr",32)(1,"td",33),n(2,' No ports added yet. Click "Add Port" to get started. '),o()()),t&2){let e=s(2);r(),m("colSpan",e.displayedColumns.length)}}function pe(t,i){if(t&1&&(a(0,"mat-card",11)(1,"div",12)(2,"table",13),_(3,14),p(4,Jt,2,0,"th",15)(5,Kt,2,1,"td",16),g(),_(6,17),p(7,Wt,2,0,"th",15)(8,Xt,2,1,"td",16),g(),_(9,18),p(10,Zt,2,0,"th",15)(11,te,2,1,"td",16),g(),_(12,19),p(13,ee,2,0,"th",15)(14,ie,2,1,"td",16),g(),_(15,20),p(16,ae,2,0,"th",15)(17,oe,2,1,"td",16),g(),_(18,21),p(19,ne,2,0,"th",15)(20,re,7,0,"td",16),g(),p(21,le,1,0,"tr",22)(22,me,1,0,"tr",23)(23,de,3,1,"tr",24),o()(),u(24,"mat-paginator",25),o()),t&2){let e=s();r(2),m("dataSource",e.dataSource),r(19),m("matHeaderRowDef",e.displayedColumns),r(),m("matRowDefColumns",e.displayedColumns),r(2),m("pageSizeOptions",k(5,Qt))("pageSize",3)}}var Tt=class t{constructor(i,e,l){this.snackBar=i;this.dialog=e;this.commService=l}isLoading=!0;maxPorts=3;displayedColumns=["name","baudRate","dataBits","parity","stopBits","actions"];dataSource=new gt([]);paginator;ngOnInit(){this.commService.getPortsLoadingStatus().subscribe(i=>{this.isLoading=i}),this.commService.getSerialPortsStream().subscribe(i=>{this.dataSource.data=i},i=>{console.error("Error loading Serial Ports:",i),this.showMessage("Could not load Serial configuration","error")})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}openPortForm(i){let e=this.dataSource.data.map(d=>d.id);this.dialog.open(E,{width:"500px",data:{port:i||null,baudRates:this.commService.BAUD_RATES,dataBits:this.commService.DATA_BITS,stopBits:this.commService.STOP_BITS,parityOptions:this.commService.PARITIES,availablePorts:this.commService.getAllPortDefinitions(),configuredPortIds:e}}).afterClosed().subscribe(d=>{if(d)if(i){let S=d,{portId:M}=S,Rt=B(S,["portId"]);this.commService.updateSerialPort(i.id,Rt).subscribe(()=>{this.showMessage(`Updated ${i.alias}`,"success")},()=>this.showMessage("Error while updating","error"))}else this.commService.addSerialPort(d).subscribe(M=>{this.showMessage(`Added ${M.alias}`,"success")},M=>{this.showMessage(M.error?.message||"Error when adding port","error")})})}deletePort(i){this.dialog.open(Ot,{width:"350px",data:{title:"Delete Port",message:`Are you sure you want to delete "${i.alias}"? This action will reset the port configuration on the device.`,type:"danger"}}).afterClosed().subscribe(l=>{l&&this.commService.deleteSerialPort(i.id).subscribe(()=>{this.showMessage(`Deleted ${i.alias}`,"info")},()=>this.showMessage("Error when deleting port","error"))})}showMessage(i,e){this.snackBar.open(i,"Close",{duration:3e3,panelClass:[`${e}-snackbar`]})}formatParity(i){return i?i.replace("PARITY_",""):""}static \u0275fac=function(e){return new(e||t)(c(j),c(Dt),c(bt))};static \u0275cmp=x({type:t,selectors:[["app-serial"]],viewQuery:function(e,l){if(e&1&&T(w,5),e&2){let d;R(d=N())&&(l.paginator=d.first)}},decls:16,vars:3,consts:[[1,"serial-container"],[1,"page-header"],[1,"header-content"],[1,"page-title"],[1,"title-icon"],[1,"page-subtitle"],[1,"header-actions"],["mat-flat-button","","color","primary",3,"click","disabled"],["class","loading-spinner",4,"ngIf"],["class","table-card mat-elevation-z4",4,"ngIf"],[1,"loading-spinner"],[1,"table-card","mat-elevation-z4"],[1,"table-container"],["mat-table","","aria-label","Serial ports configuration",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","baudRate"],["matColumnDef","dataBits"],["matColumnDef","parity"],["matColumnDef","stopBits"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of ports",3,"pageSizeOptions","pageSize"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell",3,"colSpan"]],template:function(e,l){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3)(4,"mat-icon",4),n(5,"cable"),o(),n(6," Serial Configuration "),o(),a(7,"p",5),n(8," Manage and configure Serial ports (RS-485) "),o()(),a(9,"div",6)(10,"button",7),C("click",function(){return l.openPortForm()}),a(11,"mat-icon"),n(12,"add"),o(),n(13," Add Port "),o()()(),p(14,Ut,4,0,"div",8)(15,pe,25,6,"mat-card",9),o()),e&2&&(r(10),m("disabled",l.dataSource.data.length>=l.maxPorts),r(4),m("ngIf",l.isLoading),r(),m("ngIf",!l.isLoading))},dependencies:[P,b,X,W,D,y,z,q,V,xt,Mt,_t,ot,rt,pt,lt,nt,st,mt,dt,ct,ft,ut,vt,w],styles:[".serial-container[_ngcontent-%COMP%]{min-height:calc(100vh - var(--header-height) - 48px);animation:_ngcontent-%COMP%_fadeIn .5s ease-in}.page-header[_ngcontent-%COMP%]{margin-bottom:24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{margin:0 0 8px;display:flex;align-items:center;gap:12px;color:var(--primary-color);font-size:1.8rem;font-weight:500}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]   .title-icon[_ngcontent-%COMP%]{font-size:2rem;color:var(--accent-color)}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .page-subtitle[_ngcontent-%COMP%]{margin:0;color:#666;font-size:1rem;line-height:1.5}.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:16px;color:#0009}.table-card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 4px 20px #00000014;overflow:hidden}.table-container[_ngcontent-%COMP%]{overflow-x:auto}th.mat-header-cell[_ngcontent-%COMP%], td.mat-cell[_ngcontent-%COMP%]{padding:12px 16px}.device-path[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:4px 8px;border-radius:4px;font-family:Courier New,monospace;font-size:.9rem;color:#333}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]})};export{Tt as SerialComponent};
